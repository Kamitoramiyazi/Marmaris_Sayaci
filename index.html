<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Çoklu Sayaç Uygulaması</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Temel Sayfa Stili */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0F0F0F; /* Siyaha yakın koyu gri */
        }
        
        /* Sayaç Kartı Stili - Yan Yana Küçülen Düzen */
        .counter-card {
            background-color: #1A1A1A; /* Hafif daha açık bir koyu renk */
            border: 1px solid #333;
            border-radius: 12px;
            padding: 16px; 
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px; 
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        /* Sayaç İsmi Stili */
        .counter-name {
            font-weight: 600;
            color: #E0E0E0; /* Tam beyaz değil, hafif kırık beyaz */
            text-transform: capitalize;
            white-space: nowrap; 
        }

        /* Sayaç Değeri Stili */
        .counter-value {
            font-weight: 700;
            color: #FACC15; /* Sarı */
            line-height: 1;
        }

        /* Sarı Buton Stili */
        .yellow-btn {
            background-color: #FACC15; /* Sarı */
            color: #1A1A1A; /* Koyu renk yazı */
            font-weight: 600;
            font-size: 16px;
            padding: 10px 24px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            white-space: nowrap; 
        }

        .yellow-btn:hover {
            background-color: #FBBF24; /* Biraz daha koyu sarı */
        }

        .yellow-btn:active {
            transform: scale(0.98); /* Tıklama efekti */
        }
    </style>
</head>
<body>
    <div class="h-screen w-full flex flex-col items-center justify-center p-4">
        <div class="w-full max-w-7xl"> <h1 class="text-5xl font-bold text-center mb-10 text-yellow-300">
                Marmaris Sayacı
            </h1>

            <div class="flex flex-row gap-4 justify-center p-4 overflow-x-auto">
                
                <div class="counter-card flex-1 min-w-0">
                    <h2 class="counter-name text-lg">sarı</h2>
                    <span id="counter-sari" class="counter-value text-4xl">0</span>
                    <button id="btn-sari" class="yellow-btn">MUZ</button>
                </div>

                <div class="counter-card flex-1 min-w-0">
                    <h2 class="counter-name text-lg">kutli</h2>
                    <span id="counter-kutli" class="counter-value text-4xl">0</span>
                    <button id="btn-kutli" class="yellow-btn">MUZ</button>
                </div>

                <div class="counter-card flex-1 min-w-0">
                    <h2 class="counter-name text-lg">başkan</h2>
                    <span id="counter-baskan" class="counter-value text-4xl">0</span>
                    <button id="btn-baskan" class="yellow-btn">MUZ</button>
                </div>

                <div class="counter-card flex-1 min-w-0">
                    <h2 class="counter-name text-lg">ogır</h2>
                    <span id="counter-ogir" class="counter-value text-4xl">0</span>
                    <button id="btn-ogir" class="yellow-btn">MUZ</button>
                </div>

                <div class="counter-card flex-1 min-w-0">
                    <h2 class="counter-name text-lg">eno</h2>
                    <span id="counter-eno" class="counter-value text-4xl">0</span>
                    <button id="btn-eno" class="yellow-btn">MUZ</button>
                </div>

                <div class="counter-card flex-1 min-w-0">
                    <h2 class="counter-name text-lg">yenge</h2>
                    <span id="counter-yenge" class="counter-value text-4xl">0</span>
                    <button id="btn-yenge" class="yellow-btn">MUZ</button>
                </div>

            </div>

            <div id="loading" class="text-center text-yellow-300 mt-4">
                Veritabanına bağlanılıyor...
            </div>
        </div>
    </div>

    <script type="module">
        // Firebase kütüphanelerini import et
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            signInAnonymously, 
            signInWithCustomToken, 
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            getDoc,
            setDoc, 
            updateDoc, 
            onSnapshot,
            increment,
            serverTimestamp,
            setLogLevel
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- DEĞİŞKENLER ---

        // Sizin sağladığınız Firebase config bilgileri:
        const firebaseConfig = {
          apiKey: "AIzaSyCZWcYv5yX0U-oPx9ilh5LbtWvUCOLfRUY",
          authDomain: "marmaris-sayaci.firebaseapp.com",
          projectId: "marmaris-sayaci",
          storageBucket: "marmaris-sayaci.firebasestorage.app",
          messagingSenderId: "841876333515",
          appId: "1:841876333515:web:08f429048f97268f2a4c4e",
          measurementId: "G-5LW4P8L5C4"
        };
        
        const appId = firebaseConfig.projectId || 'marmaris-sayac-default';
        const initialAuthToken = null; 

        // Sayaç isimleri ve ID'ler ('yenge' buraya eklendi)
        const counterIds = ["sari", "kutli", "baskan", "ogir", "eno", "yenge"];
        
        let db, auth;
        let userId = null;
        let countersDocRef; 

        // DOM Elementleri
        const loadingIndicator = document.getElementById('loading');
        const counterElements = {};
        const buttonElements = {};

        counterIds.forEach(id => {
            counterElements[id] = document.getElementById(`counter-${id}`);
            buttonElements[id] = document.getElementById(`btn-${id}`);
        });

        // --- TEMEL FONKSİYONLAR ---

        function updateUICounters(counts) {
            if (!counts) return;

            counterIds.forEach(id => {
                if (counterElements[id]) {
                    counterElements[id].textContent = counts[id] || 0;
                }
            });
        }

        async function incrementCounter(counterId) {
            if (!countersDocRef) return;

            try {
                const updates = {};
                updates[counterId] = increment(1);
                
                await updateDoc(countersDocRef, updates);
            } catch (error) {
                console.error(`Sayaç (${counterId}) güncellenirken hata oluştu: `, error);
                if (error.code === 'not-found') {
                    await initializeCounters();
                }
            }
        }

        async function initializeCounters() {
            if (!countersDocRef) return;
            
            console.log("Sayaç belgesi başlatılıyor...");
            const initialData = {
                sari: 0,
                kutli: 0,
                baskan: 0,
                ogir: 0,
                eno: 0,
                yenge: 0, // 'yenge' için başlangıç değeri eklendi
                createdAt: serverTimestamp()
            };
            
            try {
                await setDoc(countersDocRef, initialData, { merge: true });
            } catch (error) {
                console.error("Sayaçlar başlatılırken hata: ", error);
            }
        }

        function setupFirestoreListeners() {
            if (!userId) return;

            const docPath = `artifacts/${appId}/public/data/counters/allCounters`;
            countersDocRef = doc(db, docPath);

            onSnapshot(countersDocRef, 
                (docSnap) => {
                    loadingIndicator.style.display = 'none'; 
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        updateUICounters(data);
                    } else {
                        console.log("Sayaç belgesi bulunamadı, yeniden oluşturuluyor...");
                        initializeCounters();
                        updateUICounters({}); 
                    }
                },
                (error) => {
                    console.error("Firestore dinlenirken hata: ", error);
                    loadingIndicator.textContent = "Veritabanı bağlantı hatası.";
                }
            );
        }

        async function initializeFirebase() {
            if (!firebaseConfig || Object.keys(firebaseConfig).length === 0) {
                console.error("Firebase yapılandırması bulunamadı.");
                loadingIndicator.textContent = "Uygulama yapılandırması eksik.";
                return;
            }

            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                setLogLevel('Debug'); 

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        console.log("Kullanıcı doğrulandı:", user.uid);
                        userId = user.uid;
                        setupFirestoreListeners();
                    } else {
                        console.log("Kullanıcı oturumu kapalı.");
                        userId = null;
                    }
                });

                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    console.log("Anonim olarak oturum açılıyor...");
                    await signInAnonymously(auth);
                }

            } catch (error) {
                console.error("Firebase başlatılırken hata: ", error);
                loadingIndicator.textContent = "Uygulama başlatılamadı.";
            }
        }

        // --- UYGULAMAYI BAŞLAT ---

        counterIds.forEach(id => {
            if (buttonElements[id]) {
                buttonElements[id].addEventListener('click', () => {
                    incrementCounter(id);
                });
            }
        });

        initializeFirebase();

    </script>
</body>
</html>
